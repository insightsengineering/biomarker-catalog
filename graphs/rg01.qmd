---
title: RG1
subtitle: Response Graphs for Overall Population
---

------------------------------------------------------------------------

::: panel-tabset
## Setup

We will use the `synthetic_cdisc_data$adrs` data set from the `scda` package to create the response plots.
We transform the response variable into an `ordered` factor to ensure that the response labels are ordered correctly and a sequential color scheme is used in the graph.
We select Best Confirmed Overall Response by Investigator to evaluate response.
Finally, we select patients with measurable disease at baseline `(BMEASIFL == "Y")` as response evaluable patients.

For `ggplot()` used in all analyses, we add `by = BMEASIFL` in the aesthetics to support the calculation of proportions using `geom_text(stat = "prop")`.

```{r, message = FALSE}
library(tern)
library(ggplot2.utils)
library(dplyr)

adrs <- scda::synthetic_cdisc_data("rcd_2022_06_27")$adrs %>%
  df_explicit_na() %>%
  mutate(AVALC = ordered(AVALC, levels = c("<Missing>", "NE", "PD", "SD", "PR", "CR"))) %>%
  filter(PARAMCD == "BESRSPI", BMEASIFL == "Y")
```

## Standard Plot

```{r}
graph <- ggplot(adrs, aes(BMEASIFL, fill = AVALC, by = BMEASIFL)) +
  geom_bar(aes(BMEASIFL), position = "fill") +
  geom_text(stat = "prop", position = position_fill(.5)) +
  scale_y_continuous(labels = scales::percent) +
  ylab("%")

graph
```

## Binarize Response Outcome for Response Graph for Overall Population (RG1A)

We can use the `fct_collapse_only()` function from `tern` to binarize the response variable.

```{r}
adrs <- adrs %>%
  mutate(
    AVALC_BIN = fct_collapse_only(
      AVALC,
      Yes = c("CR", "PR"),
      No = c("PD", "SD", "NE", "<Missing>")
    )
  )
```

We can then produce the response plot with the newly binarized response variable.

```{r}
graph <- ggplot(adrs, aes(BMEASIFL, fill = AVALC_BIN, by = BMEASIFL)) +
  geom_bar(position = "fill") +
  geom_text(stat = "prop", position = position_fill(.5)) +
  scale_y_continuous(labels = scales::percent) +
  ylab("%")

graph
```

## Change Color Scheme of Response Graph for Overall Population (RG1B)

We can use the `scale_fill_manual()` function from `ggplot2` to change the color scheme of the plot by manually selecting colors to assign to the values.

```{r}
graph +
  scale_fill_manual("AVALC_BIN", values = c("Yes" = "blue", "No" = "red"))
```

Alternatively we can also use the `scale_fill_brewer()` function from `ggplot2` to change the color scheme of the plot by selecting a preset color palette.

```{r}
graph +
  scale_fill_brewer(palette = "Set1")
```

## Horizontal Response Graph for Overall Population (RG1C)

The `coord_flip()` function from `ggplot2` can be used to exchange the `x` and `y` coordinates, i.e. plot horizontally.

```{r}
graph +
  coord_flip()
```

{{< include ../session_info.qmd >}}
:::
