---
title: CMT2
subtitle: Cox Proportional Hazards Model Tables with Multiple Covariates
---

------------------------------------------------------------------------

::: panel-tabset
## Setup

We prepare the data similarly as in [CMT1](../tables/cmt01.qmd).

```{r, message = FALSE}
library(tern)
library(dplyr)

adtte <- scda::synthetic_cdisc_data("rcd_2022_06_27")$adtte %>%
  df_explicit_na() %>%
  filter(PARAMCD == "OS", BEP01FL == "Y") %>%
  mutate(
    AVAL = day2month(AVAL),
    AVALU = "Months",
    is_event = CNSR == 0
  ) %>%
  var_relabel(
    BMRKR1 = "Biomarker (Continuous)",
    BMRKR2 = "Biomarker (Categorical)"
  )
```

## Table

The multivariate Cox Proportional Hazards model can be displayed in a summary table using the `summarize_coxreg` function from `tern` with the `multivar` argument set to `TRUE`.
Like the corresponding model fitting function `fit_coxreg_multivar()`, we specify the time, event, arm and covariates in a `variables` list, and any further customizations via the `control` argument.
Note that the default confidence level is 95% but this can be customized via the `conf_level` element in `control`.

Rather than fitting the model and then tidying the output via the `broom::tidy()` function, we can directly input these three arguments into the `summarize_coxreg()` function to summarize the model fit in a table layout, building the table with our pre-processed `adtte` data set.

```{r}
result <- basic_table() %>%
  summarize_coxreg(
    variables = list(
      time = "AVAL",
      event = "is_event",
      arm = "ARM",
      covariates = c("AGE", "BMRKR1", "BMRKR2")
    ),
    multivar = TRUE
  ) %>%
  append_topleft("Effect/Covariate Included in the Model") %>%
  build_table(adtte)

result
```

## Changing Reference Levels in the Cox Proportional Hazards Model Table (CMT2A)

For changing the reference levels, for example to use placebo as reference for a treatment arm variable, we can just reorder the levels of the corresponding factor variables, and pass the resulting dataset to the model fitting function as before.
The `forcats` package provides convenience functions for the level reordering.

```{r}
adtte2 <- adtte %>%
  mutate(
    ARM = forcats::fct_relevel(
      ARM,
      "B: Placebo",
      "C: Combination",
      "A: Drug X"
    )
  )
```

Now we can proceed in the same way as in CMT2 above.

```{r}
result <- basic_table() %>%
  summarize_coxreg(
    variables = list(
      time = "AVAL",
      event = "is_event",
      arm = "ARM",
      covariates = c("AGE", "BMRKR1", "BMRKR2")
    ),
    multivar = TRUE
  ) %>%
  append_topleft("Effect/Covariate Included in the Model") %>%
  build_table(adtte2)

result
```

{{< include ../session_info.qmd >}}
:::
