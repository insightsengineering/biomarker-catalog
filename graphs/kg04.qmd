---
title: KG4
subtitle: Kaplan-Meier Graphs by Treatment Arm and Biomarker Subgroups
---

------------------------------------------------------------------------

::: panel-tabset
## Setup

A setup similar to [KG1](../graphs/kg01.qmd) is used, with some additional data manipulation steps to first binarize the continuous biomarker and the treatment arm variables, and then combine both into a new interaction variable `ARM_BMRKR2`.
Since we are using biomarker information, we filter on the biomarker evaluable population using the flag variable `BEP01FL`.

```{r, message = FALSE}
library(tern)
library(dplyr)

adtte <- scda::synthetic_cdisc_data("rcd_2022_06_27")$adtte %>%
  df_explicit_na() %>%
  filter(PARAMCD == "OS" & BEP01FL == "Y") %>%
  mutate(
    is_event = CNSR == 0,
    BMRKR2_BIN = fct_collapse_only(
      BMRKR2,
      High = c("HIGH"),
      Low = c("MEDIUM", "LOW")
    ),
    ARM_BIN = fct_collapse_only(
      ARM,
      CTRL = c("B: Placebo"),
      TRT = c("A: Drug X", "C: Combination")
    ),
    ARM_BMRKR2 = interaction(ARM_BIN, BMRKR2_BIN)
  )

variables <- list(tte = "AVAL", is_event = "is_event", arm = "ARM_BMRKR2")
```

## Standard Plot

We can produce the basic graph using the `g_km()` function from `tern`.

```{r}
g_km(
  df = adtte,
  variables = variables,
  annot_surv_med = FALSE,
  col = c("red", "blue", "red", "blue"),
  lty = c(1, 1, 2, 2)
)
```

We can also choose to annotate the plot with the median survival time for each of the treatment arms using the `annot_surv_med = TRUE` option.

```{r}
g_km(
  df = adtte,
  variables = variables,
  annot_surv_med = TRUE,
  col = c("red", "blue", "red", "blue"),
  lty = c(1, 1, 2, 2)
)
```

## Change Color and Line Type in Kaplan-Meier Graph by Treatment Arm and Biomarker Subgroups (KG4A)

We can customize the color and line type used in the graph with the `col` and `lty` arguments of `g_km()`.
We can first check the level order of the `ARM_BMRKR2` factor variable to know which color and line type order we need.

```{r}
levels(adtte$ARM_BMRKR2)
g_km(
  df = adtte,
  variables = variables,
  annot_surv_med = TRUE,
  col = c("green", "orange", "green", "orange"),
  lty = c(5, 5, 3, 3)
)
```

## Reorder and Rename Treatment Arms or Biomarker Groups in Kaplan-Meier Graph by Treatment Arm and Biomarker Subgroups (KG4B)

For reordering or renaming we can just modify the levels of the corresponding factors of the treatment arm and biomarker variables, and pass the result to `g_km()` as before.

```{r}
adtte_mod <- adtte %>%
  mutate(
    ARM_BMRKR2 = fct_collapse_only(
      ARM_BMRKR2,
      TRT.Low = "TRT.Low",
      TRT.High = "TRT.High",
      CTRL.Low = "CTRL.Low",
      CTRL.High = "CTRL.High"
    )
  )

g_km(
  df = adtte_mod,
  variables = variables,
  annot_surv_med = FALSE,
  col = c("red", "blue", "red", "blue"),
  lty = c(1, 1, 2, 2)
)
```

{{< include ../session_info.qmd >}}
:::
